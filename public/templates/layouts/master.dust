<!DOCTYPE html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>{+title /}</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="wrapper">
  {+body /}
</div>

<script src="js/lib/socketio.js"></script>
<script>
  var currentTree = 1;
  var percentSize = 0;
  var treeSizeOriginal = [20, 40, 35, 30, 25];
  var treeLeftPosition = [11, 26, 46, 72, 86];
  var treeSizeUnit = 'vw';
  var min = 0;
  var max = 0;
  var position = '';
  var lostWords = '';
  var lost = ''
  var count = 0;
  var fallingLeaf = 0;
  var vanishingLeaf = 0;
  var currLeafCount = 0;
  var prevLeafCount = 1000;
  var differenceLeafCount = 0;

  var socket = io.connect('/');
  socket.on('ping', function (data) {

    count += 1;
    currLeafCount = data;
    fallingLeaf = (count % 5) + 1;
    vanishingLeaf = (fallingLeaf % 5) + 1;

    differenceLeafCount = prevLeafCount - currLeafCount;

    document.getElementById('l' + fallingLeaf).style.display = 'block';
    if(differenceLeafCount > 0) {
      document.getElementById('l' + vanishingLeaf).style.display = 'none';
      document.getElementById('l' + fallingLeaf).innerHTML = '-' + differenceLeafCount;
    }

    document.getElementById('left').style.width = Math.round(data/10) + '%';
    var lost = 100 - Math.round(data/10) + '%';
    document.getElementById('lost').style.width = lost;
    document.getElementById('lost').innerHTML = lost + ' forrest lost ';

    if(data > 900 && data <= 1000) {
      min = 900;
      max = 1000

      treeSize = treeSizeOriginal[currentTree-1]*((data-min)/(max-min));
      document.getElementById('t' + currentTree).style.width = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.left = treeLeftPosition[currentTree-1] - treeSize/2 + treeSizeUnit;
    }
    else if(data > 550 && data <= 900) {
      document.getElementById('t' + currentTree).style.width = 0 + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = 0 + treeSizeUnit;
      document.getElementById('f' + currentTree).style.display = 'none';

      min = 550;
      max = 900;
      currentTree = 2;

      treeSize = treeSizeOriginal[currentTree-1]*((data-min)/(max-min));
      document.getElementById('t' + currentTree).style.width = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.left = treeLeftPosition[currentTree-1] - treeSize/2 + treeSizeUnit;
    }
    else if(data > 300 && data <= 550) {
      document.getElementById('t' + currentTree).style.width = 0 + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = 0 + treeSizeUnit;
      document.getElementById('f' + currentTree).style.display = 'none';

      min = 300;
      max = 550;
      currentTree = 3;

      treeSize = treeSizeOriginal[currentTree-1]*((data-min)/(max-min));
      document.getElementById('t' + currentTree).style.width = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.left = treeLeftPosition[currentTree-1] - treeSize/2 + treeSizeUnit;
    }
    else if(data > 100 && data <= 300) {
      document.getElementById('t' + currentTree).style.width = 0 + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = 0 + treeSizeUnit;
      document.getElementById('f' + currentTree).style.display = 'none';

      min= 100;
      max = 300;
      currentTree = 4;

      treeSize = treeSizeOriginal[currentTree-1]*((data-min)/(max-min));
      document.getElementById('t' + currentTree).style.width = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.left = treeLeftPosition[currentTree-1] - treeSize/2 + treeSizeUnit;
    }
    else if(data > 1 && data <= 100){
      document.getElementById('t' + currentTree).style.width = 0 + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = 0 + treeSizeUnit;
      document.getElementById('f' + currentTree).style.display = 'none';

      min = 0;
      max = 100;
      currentTree = 5;

      treeSize = treeSizeOriginal[currentTree-1]*((data-min)/(max-min));
      document.getElementById('t' + currentTree).style.width = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = treeSize + treeSizeUnit;
      document.getElementById('t' + currentTree).style.left = treeLeftPosition[currentTree-1] - treeSize/2 + treeSizeUnit;
    } else {
      document.getElementById('b').style.display = 'none';
      document.getElementById('t' + currentTree).style.width = 0 + treeSizeUnit;
      document.getElementById('t' + currentTree).style.height = 0 + treeSizeUnit;

      document.getElementById('lost').style.width = '100%';
      document.getElementById('lost').innerHTML = 'all forrest is lost :(';
    }

    prevLeafCount = data;

  });
</script>

</body>
</html>
